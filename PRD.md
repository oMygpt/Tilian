# 产品名称：智能教材语料生成与校验平台 (Intelligent Textbook Corpus Gen & Verify Platform)
## 1. 产品综述 (Product Overview)
本平台旨在为教师提供一站式的教材结构化处理与语料生产工具。通过集成高精度OCR解析服务（MinerU）与多模型LLM能力，将非结构化教材（PDF等）转化为高质量的问答对（Q&A）与习题集。平台强调“人机协作（Human-in-the-Loop）”的工作流，确保生成内容的准确性与可溯源性，最终输出标准化的结构数据。
## 2. 核心功能模块 (Core Functional Modules)
### 模块一：教材导入与解析引擎 (Ingestion & Parsing Engine)
此模块负责处理源文件的输入与结构化转换，是数据质量的基石。
源文件支持 (Source Support): 支持上传PDF为核心格式，预留Word/Markdown等格式接口。
智能解析 (Intelligent Parsing): 调用 MinerU API 对上传文档进行深度解析。
输出标准: 必须同时获取并存储解析后的 JSON 数据（用于程序逻辑处理）和 MD (Markdown) 文件（用于内容展示）。
元数据管理 (Metadata Management):解析完成后，系统自动提取书籍元数据（书名、作者、出版年份、ISBN等）。
人工确认: 提供弹窗或侧边栏供用户校验元数据，支持手动修改补全，确认后方可进入下一流程。
### 模块二：内容分片与上下文管理 (Segmentation & Context Management)
此模块解决LLM输入限制（Context Window）与教材章节逻辑的冲突。
智能分章 (Chapter Segmentation): 基于解析出的JSON结构，自动识别章节层级。
Token 优化: 自动计算每个章节的Token数量。若章节内容超过LLM上下文窗口限制（Max Token），系统需提示并执行“子章节切分”或“逻辑分块”策略。
结构化存储: 将切分后的内容建立索引，确保生成的习题能精准回溯到对应的章节原文。
### 模块三：沉浸式阅读与交互工作台 (Immersive Reading Workbench)
基于开源项目 Read3 的逻辑构建，提供“左文右大模型”或“所见即所得”的交互体验。
#### 阅读器视图 (Reader View):
分页逻辑: 严格执行“一章一页”的展示逻辑，减少认知负荷。
渲染能力: 集成 LaTeX 渲染引擎 (如 MathJax 或 KaTeX)，确保数学公式、化学方程式、图表在Markdown模式下完美显示，无乱码。
#### 生成控制面板 (Generation Control):
模型路由 (Model Router): 用户可在界面实时切换模型 API（Gemini / ChatGPT / DeepSeek / Kimi）。系统需记录用户对每个章节偏好的模型。
任务类型: 提供独立的【生成问答对】和【生成习题】按钮，互不干扰。
Prompt 模板管理: 支持用户查看当前使用的Prompt，并允许进行“当前会话修改”或“全局模板更新”。
### 模块四：人机校验与数据闭环 (Verification & Data Loop)
此模块是保证语料质量的核心，强调教师的审核权。
生成结果展示: * 生成内容需结构化展示：【问题/题干】、【选项（如适用）】、【标准答案】、【解析】。
溯源标记: 自动标记生成该内容所使用的模型名称及版本号（例如：Generated by GPT-4o）。
编辑与状态流转:
编辑态: 教师可直接修改生成的内容（修正幻觉、优化措辞、调整公式）。
状态标记: 每条数据具备状态机：待生成 -> 已生成 -> 已校验(Verified)。
自动保存: 用户修改或点击“确认”后，系统自动触发保存，无需手动存盘。
进度可视化: 在侧边栏章节目录旁显示进度指示器（例如：第一章 - 100% 已校验）。
### 模块五：数据导出与交付 (Export & Delivery)
批量导出: 支持按整本书籍进行导出。
格式规范:Excel/CSV: 列头应包含：章节ID、章节名、原文片段、题目类型、题干、答案、解析、生成模型、校验状态。确保导出的数学公式保留LaTeX源码格式，以便后续入库使用。
## 3. 用户场景故事 (User Stories)
为了帮助开发人员理解业务流，以下是两个典型场景：
### 场景 A：教材上传与预处理
作为 一名数学老师，我想要 上传一本《高等数学》PDF，并确认MinerU解析出的公式是否正确，以便于 系统能基于正确的符号生成后续的微积分习题。
验收标准: 上传后，系统自动填好书名，我能在预览界面看到公式 $\lim_{x \to 0} \frac{\sin x}{x} = 1$ 显示正常，而非乱码。
### 场景 B：习题生成与纠错
作为 一名负责审核的教研员，我想要 在阅读“第三章：矩阵变换”时，调用 DeepSeek 模型生成5道选择题，并且 在发现第2题答案有误时，能直接修改并标记为“已确认”，以便于 导出的Excel中包含的是我修正后的正确版本，而不是AI生成的错误版本。
## 4. 非功能性需求 (Non-Functional Requirements)
性能 (Performance): 翻页加载速度需小于1秒；MinerU解析大文件（>100MB）时需提供清晰的后台进度条或异步通知。
兼容性 (Compatibility): 公式渲染需兼容主流LaTeX语法；导出文件需避免编码问题（推荐 UTF-8 with BOM）。
扩展性 (Scalability): LLM 接口层需设计为插件式架构，方便未来快速接入新的模型（如 Claude 3.5 或 Llama 3）。
