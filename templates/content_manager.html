<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†…å®¹ç®¡ç† - æ™ºèƒ½æ•™æè¯­æ–™ç”Ÿæˆå¹³å°</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/reading.css">
    <link rel="stylesheet" href="/static/css/content_manager.css">
    <!-- MathJax for LaTeX rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" async></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar with filters -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="header-top">
                    <h3>{{ _('å†…å®¹ç­›é€‰') }}</h3>
                    <a href="/reading/{{ book_id }}" class="btn-back">â† {{ _('è¿”å›é˜…è¯»') }}</a>
                </div>
            </div>

            <div class="filter-section">
                <h4>{{ _('æœç´¢') }}</h4>
                <div class="search-box">
                    <input type="text" id="keywordSearch" placeholder="{{ _('æœç´¢é¢˜ç›®æˆ–ç­”æ¡ˆ...') }}">
                </div>
            </div>

            <div class="filter-section">
                <div class="section-header">
                    <h4>{{ _('éªŒè¯è¿›åº¦') }}</h4>
                </div>
                <div class="progress-dashboard" id="progressDashboard">
                    <div class="progress-stats">
                        <div class="stat-item">
                            <span class="stat-label">{{ _('æ€»ç”Ÿæˆ') }}</span>
                            <span class="stat-value" id="totalGenerated">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">{{ _('å·²æ ¡éªŒ') }}</span>
                            <span class="stat-value" id="totalVerified">0</span>
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="overallProgressFill" style="width: 0%"></div>
                        </div>
                        <div class="progress-text" id="overallProgressText">0%</div>
                    </div>
                </div>
            </div>

            <div class="filter-section">
                <h4>{{ _('å†…å®¹ç±»å‹') }}</h4>
                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="contentType" value="qa" checked>
                        {{ _('é—®ç­”å¯¹') }}
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="contentType" value="exercise" checked>
                        {{ _('ä¹ é¢˜') }}
                    </label>
                </div>
            </div>

            <div class="filter-section">
                <h4>{{ _('çŠ¶æ€') }}</h4>
                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="status" value="generated" checked>
                        {{ _('å·²ç”Ÿæˆ') }}
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="status" value="verified" checked>
                        {{ _('å·²æ ¡éªŒ') }}
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="status" value="pending">
                        {{ _('å¾…ç”Ÿæˆ') }}
                    </label>
                </div>
            </div>

            <div class="filter-section">
                <div class="section-header">
                    <h4>{{ _('æ‰¹é‡æ“ä½œ') }}</h4>
                </div>
                <div class="action-panel">
                    <label class="checkbox-label select-all-label">
                        <input type="checkbox" id="selectAllContent">
                        {{ _('å…¨é€‰æ‰€æœ‰å†…å®¹') }}
                    </label>
                    <div class="selection-info">
                        <span class="selection-count" id="selectionCount">{{ _('å·²é€‰ 0 é¡¹') }}</span>
                    </div>
                    <button id="exportBtn" class="btn primary full-width" disabled>
                        <span class="icon">ğŸ“¥</span> {{ _('å¯¼å‡ºé€‰ä¸­é¡¹') }}
                    </button>
                </div>
            </div>

            <!-- Chapter filter removed as requested -->
        </aside>

        <!-- Main content area -->
        <main class="main-content">
            <div class="content-header">
                <div class="header-left">
                    <h2>{{ _('ç”Ÿæˆå†…å®¹ç®¡ç†') }}</h2>
                    <span class="result-count" id="resultCount">{{ _('åŠ è½½ä¸­...') }}</span>
                </div>
                <div class="header-actions">
                    <button id="refreshBtn" class="btn secondary">
                        <span class="icon">ğŸ”„</span> {{ _('åˆ·æ–°') }}
                    </button>
                </div>
            </div>

            <div class="content-list" id="contentList">
                <!-- Content items loaded via JS -->
                <div class="loading-state">{{ _('æ­£åœ¨åŠ è½½å†…å®¹...') }}</div>
            </div>
        </main>
    </div>

    <!-- Edit Modal - Full Screen Overlay -->
    <div id="editModal" class="modal-overlay">
        <div class="modal-editor">
            <div class="editor-header">
                <div class="editor-title">
                    <h2>ğŸ“ {{ _('ç¼–è¾‘å†…å®¹') }}</h2>
                    <span class="editor-subtitle">{{ _('æ”¯æŒ LaTeX å…¬å¼å®æ—¶é¢„è§ˆ') }}</span>
                </div>
                <button class="close-btn" onclick="closeEditModal()">
                    <span>âœ•</span>
                </button>
            </div>

            <div class="editor-body">
                <form id="editForm">
                    <input type="hidden" id="editContentId">

                    <!-- Question Field -->
                    <div class="editor-field">
                        <div class="field-header">
                            <label>{{ _('é¢˜å¹² / é—®é¢˜') }}</label>
                            <span class="field-hint">{{ _('æ”¯æŒ LaTeX: ä½¿ç”¨ $...$ æˆ– $$...$$') }}</span>
                        </div>
                        <div class="split-panes">
                            <div class="editor-pane">
                                <div class="pane-label">{{ _('ç¼–è¾‘') }}</div>
                                <textarea id="editQuestion" rows="6" class="latex-input" data-preview="previewQuestion"
                                    placeholder="{{ _('è¾“å…¥é¢˜å¹²...') }}"></textarea>
                            </div>
                            <div class="preview-pane">
                                <div class="pane-label">{{ _('é¢„è§ˆ') }}</div>
                                <div id="previewQuestion" class="latex-preview"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Options Field (for exercises) -->
                    <div class="editor-field" id="editOptionsGroup" style="display: none;">
                        <div class="field-header">
                            <label>{{ _('é€‰é¡¹') }}</label>
                            <span class="field-hint">{{ _('æ¯è¡Œä¸€ä¸ªé€‰é¡¹') }}</span>
                        </div>
                        <div class="split-panes">
                            <div class="editor-pane">
                                <div class="pane-label">{{ _('ç¼–è¾‘') }}</div>
                                <textarea id="editOptions" rows="5" class="latex-input" data-preview="previewOptions"
                                    placeholder="{{ _('A. é€‰é¡¹1&#10;B. é€‰é¡¹2&#10;C. é€‰é¡¹3&#10;D. é€‰é¡¹4') }}"></textarea>
                            </div>
                            <div class="preview-pane">
                                <div class="pane-label">{{ _('é¢„è§ˆ') }}</div>
                                <div id="previewOptions" class="latex-preview"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Answer Field -->
                    <div class="editor-field">
                        <div class="field-header">
                            <label>{{ _('çŸ¥è¯†ç‚¹') }}</label>
                            <input type="text" id="editKnowledgePoint" class="full-width-input"
                                placeholder="{{ _('è¾“å…¥çŸ¥è¯†ç‚¹...') }}">
                        </div>
                        <div class="field-header">
                            <label>{{ _('ç­”æ¡ˆ') }}</label>
                            <span class="field-hint">{{ _('ç®€æ´å‡†ç¡®') }}</span>
                        </div>
                        <div class="split-panes">
                            <div class="editor-pane">
                                <div class="pane-label">{{ _('ç¼–è¾‘') }}</div>
                                <textarea id="editAnswer" rows="4" class="latex-input" data-preview="previewAnswer"
                                    placeholder="{{ _('è¾“å…¥ç­”æ¡ˆ...') }}"></textarea>
                            </div>
                            <div class="preview-pane">
                                <div class="pane-label">{{ _('é¢„è§ˆ') }}</div>
                                <div id="previewAnswer" class="latex-preview"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Explanation Field -->
                    <div class="editor-field">
                        <div class="field-header">
                            <label>{{ _('è§£æ') }}</label>
                            <span class="field-hint">{{ _('è¯¦ç»†è§£é‡Š') }}</span>
                        </div>
                        <div class="split-panes">
                            <div class="editor-pane">
                                <div class="pane-label">{{ _('ç¼–è¾‘') }}</div>
                                <textarea id="editExplanation" rows="6" class="latex-input"
                                    data-preview="previewExplanation" placeholder="{{ _('è¾“å…¥è§£æ...') }}"></textarea>
                            </div>
                            <div class="preview-pane">
                                <div class="pane-label">{{ _('é¢„è§ˆ') }}</div>
                                <div id="previewExplanation" class="latex-preview"></div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="editor-footer">
                <button class="btn-cancel" onclick="closeEditModal()">
                    <span class="icon">âœ•</span> {{ _('å–æ¶ˆ') }}
                </button>
                <button class="btn-save" onclick="saveContentEdit()">
                    <span class="icon">ğŸ’¾</span> {{ _('ä¿å­˜ä¿®æ”¹') }}
                </button>
            </div>
        </div>
    </div>

    <script>
        const BOOK_ID = {{ book_id }};
        window.translations = {{ js_translations | tojson }};
        window.t = function (key, params) {
            let text = window.translations[key] || key;
            if (params) {
                for (let k in params) {
                    text = text.replace('{' + k + '}', params[k]);
                }
            }
            return text;
        };
    </script>
    <script src="/static/js/content_manager.js"></script>
</body>

</html>