<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>阅读工作台 - 智能教材语料生成平台</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/reading.css">
    <!-- MathJax for LaTeX rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" async></script>
</head>

<body>
    <div class="reading-container">
        <!-- Sidebar with chapter navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="header-top">
                    <h3 id="bookTitle">Loading...</h3>
                    <a href="/" class="btn-back">← 返回</a>
                </div>
                <div class="header-controls">
                    <label class="checkbox-label">
                        <input type="checkbox" id="selectAllChapters">
                        全选
                    </label>
                    <span id="selectedCount" class="selected-count" style="display: none;">已选 0 项</span>
                </div>
            </div>
            <div class="chapter-tree" id="chapterTree">
                <!-- Chapters will be loaded here -->
            </div>
        </aside>

        <!-- Main content area -->
        <main class="content-area">
            <!-- Chapter content -->
            <div class="chapter-display" id="chapterDisplay">
                <div class="chapter-header">
                    <h2 id="chapterTitle">Select a chapter</h2>
                    <div class="chapter-meta">
                        <span id="chapterTokens" class="token-count">0 tokens</span>
                        <button id="splitChapterBtn" class="btn btn-warning btn-small" style="display: none;">
                            <span class="icon">✂️</span>
                            切分章节
                        </button>
                    </div>
                </div>
                <div id="chapterContent" class="markdown-content">
                    <!-- Markdown content will be rendered here -->
                </div>
            </div>
        </main>

        <!-- Right control panel -->
        <aside class="control-panel">
            <div class="panel-header">
                <h3>生成控制台</h3>
            </div>

            <!-- Model selection -->
            <div class="control-section">
                <label for="modelSelect">选择模型</label>
                <select id="modelSelect" class="model-select">
                    <!-- Models will be loaded dynamically -->
                </select>
            </div>

            <!-- Generation buttons -->
            <div class="control-section">
                <h4>内容生成</h4>
                <button id="generateQA" class="btn btn-primary btn-block">
                    <span class="icon">💬</span>
                    生成问答对
                </button>
                <button id="generateExercise" class="btn btn-primary btn-block">
                    <span class="icon">✏️</span>
                    生成习题
                </button>
            </div>

            <!-- Prompt template viewer -->
            <div class="control-section">
                <h4>Prompt 模板</h4>
                <button id="viewPrompt" class="btn btn-secondary btn-block">
                    查看/编辑 Prompt
                </button>
            </div>

            <!-- Progress indicator -->
            <div class="control-section">
                <h4>验证进度</h4>
                <div class="progress-indicator" id="progressIndicator">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <p class="progress-text" id="progressText">0 / 0 (0%)</p>
                </div>

                <!-- Batch Generation Progress -->
                <div id="batchProgress" class="batch-progress" style="display: none;">
                    <h4>批量生成进度</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="batchProgressFill" style="width: 0%"></div>
                    </div>
                    <p class="progress-text" id="batchProgressText">正在生成 0/0...</p>
                </div>
            </div>

            <!-- Export button -->
            <div class="control-section">
                <button id="exportBook" class="btn btn-success btn-block">
                    <span class="icon">📥</span>
                    导出数据
                </button>
            </div>

            <!-- Generated content display -->
            <div class="control-section">
                <h4>已生成内容</h4>
                <div id="generatedContent" class="generated-content-list">
                    <!-- Generated content cards will appear here -->
                </div>
            </div>
        </aside>
    </div>

    <!-- Split Chapter Confirmation Modal -->
    <div id="splitModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>切分章节确认</h3>
            <p>当前章节包含 <strong id="splitTokenCount">0</strong> tokens，将根据所选模型的token限制进行切分。</p>
            <div class="form-group">
                <label for="splitModelSelect">选择目标模型</label>
                <select id="splitModelSelect" class="model-select">
                    <!-- Models will be loaded dynamically -->
                </select>
            </div>
            <p class="hint">切分后原章节将被替换为多个较小的子章节。</p>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeSplitModal()">取消</button>
                <button type="button" class="btn btn-warning" onclick="confirmSplit()">确认切分</button>
            </div>
        </div>
    </div>

    <!-- Prompt Editor Modal -->
    <div id="promptModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <h3>Prompt 模板编辑</h3>
            <div class="prompt-tabs">
                <button class="tab-btn active" data-type="qa">问答对模板</button>
                <button class="tab-btn" data-type="exercise">习题模板</button>
            </div>
            <textarea id="promptEditor" rows="15" class="prompt-editor"></textarea>
            <p class="hint">模板中可使用 {chapter_title} 和 {chapter_content} 作为占位符</p>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closePromptModal()">取消</button>
                <button type="button" class="btn btn-primary" onclick="savePrompt()">保存修改</button>
            </div>
        </div>
    </div>

    <script src="/static/js/reading.js"></script>
</body>

</html>